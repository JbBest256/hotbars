{% extends "account/base.html" %}
{% load widget_tweaks %}
{% load static %}
{%block navigation%}
				<!-- Profile navigation -->
				<div class="navbar navbar-expand-lg border-bottom py-2">
					<div class="container-fluid">
						<ul class="nav navbar-nav flex-row flex-fill">
							<li class="nav-item me-1">
								<a href="{% url 'home'  %}" class="navbar-nav-link navbar-nav-link-icon active rounded" >
									<div class="d-flex align-items-center mx-lg-1">
										<i class="ph-activity"></i>
										<span class="d-none d-lg-inline-block ms-2">Home</span>
									</div>
								</a>
							</li>
							<li class="nav-item me-1">
								
									<div class="d-flex align-items-center mx-lg-1">
									<a href="{% url 'counter'  %}" class="navbar-nav-link navbar-nav-link-icon rounded" >
										<i class="ph-calendar"></i>
										<span class=" d-lg-inline-block ms-2">
											Counter
										
										</span>
									</a>
									{%if incart%}
					<a href="{% url 'countercart'  %}" id="counter_cart" class="navbar-nav-link navbar-nav-link-icon rounded-pill" >
						<i class="ph-shopping-cart"></i>
						<span id="cart-count" class="badge bg-yellow text-black position-absolute top-0 end-0 translate-middle-top zindex-1 rounded-pill mt-1 me-1">0</span>
					</a>
							{%else%}
					<a href="{% url 'countercart'  %}"  id="counter_cart" class="d-none navbar-nav-link navbar-nav-link-icon rounded-pill" >
						<i class="ph-shopping-cart"></i>
						<span id="cart-count" class="badge bg-yellow text-black position-absolute top-0 end-0 translate-middle-top zindex-1 rounded-pill mt-1 me-1">0</span>
					</a>
							{%endif%}
									</div>
								
							</li>
							<li class="nav-item me-1">
								<a href="#schedule" class="navbar-nav-link navbar-nav-link-icon rounded" data-bs-toggle="tab">
									<div class="d-flex align-items-center mx-lg-1">
										<i class="ph-calendar"></i>
										<span class=" d-lg-inline-block ms-2">
											Tables
											<span class="badge bg-success rounded-pill ms-auto ms-lg-2">32</span>
										</span>
									</div>
								</a>
							</li>
							<li class="nav-item me-1">
								<a href="#schedule" class="navbar-nav-link navbar-nav-link-icon rounded" data-bs-toggle="tab">
									<div class="d-flex align-items-center mx-lg-1">
										<i class="ph-calendar"></i>
										<span class=" d-lg-inline-block ms-2">
											Menu
											<span class="badge bg-success rounded-pill ms-auto ms-lg-2">32</span>
										</span>
									</div>
								</a>
							</li>
							<li class="nav-item me-1">
								<a href="#schedule" class="navbar-nav-link navbar-nav-link-icon rounded" data-bs-toggle="tab">
									<div class="d-flex align-items-center mx-lg-1">
										<i class="ph-calendar"></i>
										<span class=" d-lg-inline-block ms-2">
											Rooms
											<span class="badge bg-success rounded-pill ms-auto ms-lg-2">32</span>
										</span>
									</div>
								</a>
							</li>
							<li class="nav-item me-1">
								<a href="#schedule" class="navbar-nav-link navbar-nav-link-icon rounded" data-bs-toggle="tab">
									<div class="d-flex align-items-center mx-lg-1">
										<i class="ph-calendar"></i>
										<span class=" d-lg-inline-block ms-2">
											Other Services
											<span class="badge bg-success rounded-pill ms-auto ms-lg-2">32</span>
										</span>
									</div>
								</a>
							</li>
							<li class="nav-item me-1">
								<a href="#schedule" class="navbar-nav-link navbar-nav-link-icon rounded" data-bs-toggle="tab">
									<div class="d-flex align-items-center mx-lg-1">
										<i class="ph-calendar"></i>
										<span class=" d-lg-inline-block ms-2">
											Reviews
											<span class="badge bg-success rounded-pill ms-auto ms-lg-2">32</span>
										</span>
									</div>
								</a>
							</li>
							
							
							<li class="nav-item me-1">
								<a href="{% url 'editprofile'  %}" class="navbar-nav-link navbar-nav-link-icon rounded" >
									<div class="d-flex align-items-center mx-lg-1">
										<i class="ph-gear"></i>
										<span class="    d-lg-inline-block ms-2">Edit Profile</span>
									</div>
								</a>
							</li>

							
						</ul>

						
					</div>
				</div>
				<!-- /profile navigation -->
			
			{%endblock%}
{% block content%}
<div class="row">

<div class="col-lg-6">

<!-- List with text -->
							<div class="card">
								<div class="card-header">
									<h5 class="mb-0">Start a Chat</h5>
								</div>

								<div class="list-group list-group-borderless py-2">
									<div class="list-group-item fw-semibold">Administration</div>
							{%for location in locations%}
								{% if location.location_type == 'Admin' %}
									<a href="{% url 'chat' location.name %}" class="list-group-item list-group-item-action hstack gap-3">
										<div class="status-indicator-container">
											<img src="../../../assets/images/demo/users/face1.jpg" class="w-40px h-40px rounded-pill" alt="">
											<span class="status-indicator bg-success"></span>
										</div>

										<div class="flex-fill">
											<div class="fw-semibold">{{location.name}} </div>
											<span class="text-muted">Development</span>
										</div>

										<div class="align-self-center ms-3">
											<span class="badge bg-success rounded-pill ms-auto">26</span>
										</div>
									</a>
									{% endif%}
							{%endfor%}
									
									<div class="list-group-item fw-semibold">Other Chats</div>
							{%for location in locations%}
								{% if location.location_type == 'Other' %}
									<a href="{% url 'chat' location.name %}" class="list-group-item list-group-item-action hstack gap-3">
										<div class="status-indicator-container">
											<img src="../../../assets/images/demo/users/face5.jpg" class="w-40px h-40px rounded-pill" alt="">
											<span class="status-indicator bg-success"></span>
										</div>

										<div class="flex-fill">
											<div class="fw-semibold">{{location.name}} </div>
											<span class="text-muted">Web dev</span>
										</div>

										<div class="align-self-center ms-3">
											<span class="badge bg-success rounded-pill ms-auto">26</span>
										</div>
									</a>
									{%endif%}
							{%endfor%}
									
									
								
								</div>
							</div>
							<!-- /list with text -->



							<!-- Line content divider -->
							<div class="card">
								<div class="card-header">
									<h5 class="mb-0">Start a Chat</h5>
									
								</div>

								<div class="card-body">
									<div class="media-chat-scrollable mb-3">
										<div class="media-chat vstack gap-2">
											{%for location in locations%}
									<div>
									<a href="{% url 'chat' location.name %}">{{location.name}} ({{location.capacity}})</a>
									</div>
									{%endfor%}
										</div>
									</div>

			                    	
								</div>
							</div>
							<!-- /line content divider -->


							

						</div>
						<div class="col-lg-6">

							

							<!-- Chat UI -->
							<div class="card">
								<div class="card-header">
									
								</div>

								<div class="card-body">
									<div class="media-chat-scrollable mb-3">
										<div class="text-center">
											Hello Talk to Us 

											
										</div>
									</div>

			                    	
								</div>
							</div>
							<!-- /Chat Ui -->

						</div>

						
					</div>
 <div id="chat">
        
        
        
    </div>
    <script>
        const userId = '{{ request.user.id }}'; // Retrieve the user ID from the Django template
const socket = new WebSocket('ws://localhost:8000/ws/echo/?user_id=' + userId);

socket.onopen = function(event) {
    console.log('WebSocket connection established');
};


socket.onmessage = function(event) {
    const data = JSON.parse(event.data);
    console.log('Received message:', data); // Log the received message data
    displayMessage(data);
};

function sendMessage() {
	
    const messageInput = document.getElementById('messageInput');
    const message = messageInput.value.trim();
    const username = "{{request.user.user_name}}"; // Retrieve the username from the Django template
	if (message !== '') {
        console.log('Sending message:', message); // Log the message being sent
        // ... (existing code)
    }
    if (message !== '') {
        const data = {
            message: message,
            username: username
        };
        socket.send(JSON.stringify(data));
		console.log('Sent message:', message); // Log the message being sent
        messageInput.value = '';
    }
}
socket.onerror = function(error) {
    console.error('WebSocket error:', error);
};

function displayMessage(message) {
	
    const chatMessages = document.getElementById('chatMessages');
    const messageElement = document.createElement('div');
	if(message.username == "{{request.user.user_name}}"){
    messageElement.classList.add('media-chat-item', 'media-chat-item-reverse');
	}else{
	messageElement.classList.add('media-chat-item', 'media-chat-item');
	}
    messageElement.innerHTML = `
        <div class="media-chat-message">
            <div class="fs-sm lh-sm">
                <span class="fw-semibold">${message.username}</span>
                <span class="opacity-50 ms-2">${message.timestamp}</span>
            </div>
            ${message.message}
        </div>
    `;
	
	
	
    chatMessages.appendChild(messageElement);
}

    </script>	
{% endblock%}